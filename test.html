<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>用户编辑-一苇以航</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script src="./js/app.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<html>
<table id="demo" lay-filter="test"></table>
<button id="addEmpId" type="button" class="layui-btn layui-btn-fluid layui-btn-lg layui-btn-normal">添加员工</button>
</html>


<script type="text/javascript">
		 	
    layui.use(['table'],function(){
  
      var table = layui.table;
      var layer = layui.layer;
      var $ = layui.jquery;
      /* 
                      获取员工列表
                   */
      table.render({
        elem:"#demo", // 设置指定数据表格生成的容器ID
          id:"tId",     // 设置数据表格刷新的ID
            url:"http://127.0.0.1:8080/getEmployeePage",  // 获取数据的请求地址
              page:true,   // 是否开启分页
                limit:5,     // 每页显示多少条数
                  limits:[5,10,15],  // 动态修改页容量
                    request:{            // 自定义获取分页数据的请求参数默认为 page  limit
                      pageName:'pageNo',
                             limitName:'pageSize'
                            },
        parseData:function(d){   // 重新定义数据的返回格式成layui默认的格式
          return {
          code:d.code==200?0:d.code,
          count:d.obj.count,
          data:d.obj.data
        };
                             },
        cols:[[   // 数据表格的列设置
               {field:"empId",title:"员工编号",width:"14.2%",sort:true},
               {field:"empName",title:"员工名称",width:"14.2%",sort:true},
               {field:"age",title:"年龄",width:"14.2%",sort:true},
               {field:"gender",title:"性别",width:"14.2%",sort:true,templet:function(d){
                 return d.gender==0?'女':'男';
               }},
               {field:"hireDate",title:"入职时间",width:"14.2%",sort:true},
               {field:"deptName",title:"部门",width:"14.2%",sort:true,templet:function(dd){
                 return dd.department.deptName;
               }},
               {title:"操作",width:"15.5%",align:"center",templet:function(d){
                 var str="<button type='button' class='layui-btn layui-btn-xs layui-btn-danger' lay-event='del'>删除</button>";
                 str+="<button type='button' class='layui-btn layui-btn-xs layui-btn-warm' lay-event='edit'>更新</button>";
                 return str;
               }}
              ]]
      });
    });

    $("#addEmpId").click(function(){
  layer.open({
    type:2,
    title:"添加员工",
    content:"./emp_add.html",
    area:["600px","500px"],
    shade:0.3,
    anim:5,
    end:function(){
    console.log("添加层被关闭了....");
    //刷新整合页面
    //location.reload();
    //只重载表格
    table.reload("tId");
   }
  });
});

/*
	toolbar绑定工具条
*/
table.on('tool(test)',function(obj){
  //获取当前行数据
  var data = obj.data;
  console.log(data);
  //获取当前行点击的事件
  var e = obj.event;
  if(e=='del'){
    //弹出删除窗口,确认是否删除
    layer.confirm("是否删除?",{icon:3,title:"提示"},function(index){
      //调用AJAX删除后台数据--> 获取删除数据的ID
      $.getJSON("http://localhost:8080/deleteEmployee",{empId:data.empId},function(d){
        if(d.code!=200){
          //删除失败
          layer.msg(d.msg);
        }else{
          //关闭弹出层
          layer.close(index);
          //刷新表格
          table.reload("tId");
        }
      });
    });
  }else if(e=='edit'){
    //弹出更新弹出层
    layer.open({
      type:2,
      title:"更新员工",
      content:"./emp_update.html",
      area:["600px","500px"],
      shade:0.3,
      anim:5,
      end:function(){
        console.log("更新层被关闭了....");
        //只重载表格
        table.reload("tId");
      },
      success:function(layero,index2){
        //更新弹出层表单数据进行回显
        var body = layer.getChildFrame("body",index2);
        body.find("#empId").val(data.empId);//员工ID回显
        body.find("#empName").val(data.empName);//员工名称
        body.find("#age").val(data.age); //员工年龄
        body.find("#date").val(data.hireDate); //入职时间
        //性别回显
        body.find("input[name='gender'][value=0]").attr("checked",data.gender==0?true:false);
        body.find("input[name='gender'][value=1]").attr("checked",data.gender==1?true:false);
        //下拉部门回显,将部门ID传递到弹出层表单的隐藏域中
        body.find("#hiddenDeptId").val(data.department.deptId);
      }
    });
  }else{
    //其他
    layer.msg("对不起,功能还在路上...");
  }
});
  </script>


</html>